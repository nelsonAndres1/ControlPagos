<h2 class="page-title">Estado del Pago</h2>

<form class="estado-form">
  <!-- TABLA (responsive con scroll horizontal) -->
  <div class="table-wrap">
    <table class="table table-striped table-sm align-middle">
      <thead>
        <tr>
          <th scope="col">Tipo de Pago</th>
          <th scope="col">Estado</th>
          <th scope="col">Usuario</th>
          <th scope="col">Valor</th>
          <th scope="col">Fecha</th>
          <th scope="col">Hora</th>
          <th scope="col">Soportes</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of item1">
          <td>{{ item2.detclas }}</td>
          <td>{{ obtenerNombreEstado(r.estado) }}</td>
          <td>
            <a (click)="nombreUsuario(r.usuario)" class="link">{{ r.usuario }}</a>
          </td>
          <td>${{ data?.valor }}</td>
          <td>{{ r.fecha }}</td>
          <td>{{ r.hora }}</td>
          <td>
            <button type="button" class="btn btn-sm btn-link" (click)="toggleVisor()">
              {{ visorAbierto ? 'Ocultar' : 'Ver' }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- SOPORTES -->
  <h3 class="mt-3">Soportes del Pago</h3>

  <div *ngIf="cargandoSoportes" class="mb-2">
    Cargando soportes...
  </div>

  <div *ngIf="!cargandoSoportes && soportes?.length; else noSoportes" class="soportes-list">
    <div *ngFor="let so of soportes" class="soporte-item">
      <div class="soporte-row">
        <strong class="soporte-title">
          {{ so.detsop || so.descripcion || so.archivo }}
        </strong>

        <button type="button" class="btn btn-sm btn-outline-secondary w-100-sm" (click)="verPDF(so)">
          Ver
        </button>
      </div>

      <div *ngIf="visorAbierto && so === soporteSeleccionado" class="visor mt-2">
        <pdf-viewer [src]="global_url + 'teso12/getDocumento/' + so.archivo" [rotation]="0" [original-size]="false"
          [show-all]="true" [fit-to-page]="false" [zoom]="1" [zoom-scale]="'page-width'" [stick-to-page]="false"
          [render-text]="true" [external-link-target]="'blank'" [autoresize]="true" [show-borders]="false"
          style="width: 100%; height: 400px;"></pdf-viewer>
      </div>
    </div>
  </div>

  <ng-template #noSoportes>
    <em>Sin soportes para este pago.</em>
  </ng-template>
</form>