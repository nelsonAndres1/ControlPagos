<div style="margin: 50px;">
    <h2>Editar Pago</h2>
    <br>

    <!-- Buscar pago por número -->
    <input class="form-control" placeholder="Numero del Pago" name="vacio" [(ngModel)]="vacio" type="text"
        (input)="getTeso13($event)" required />

    <!-- Resultados de búsqueda -->
    <div class="col-sm-12">
        <div class="card card-body mb-1" *ngFor="let result of data" (click)="getPago(result)" style="cursor: pointer;">
            <h6>Detalle: {{ result.detalle }}</h6>
            <small class="text-primary">
                <h6>Pago: {{ result.codclas }}{{ result.numero }}</h6>
            </small>
            <div class="col-sm-12">
                <button type="button" class="btn btn-success">Editar</button>
            </div>
        </div>
    </div>

    <!-- Formulario de edición -->
    <form #registerForm="ngForm" (ngSubmit)="onSubmit(registerForm)" *ngIf="bandera_formulario">
        <div class="form-group col-md-12">

            <hr />

            <!-- NIT -->
            <div class="row">
                <div class="col">
                    <label><b>NIT</b></label>
                    <div class="col">
                        <div class="form-outline">
                            <input type="text" class="form-control" name="nit_name" placeholder="nit"
                                (input)="getConta04($event)" [(ngModel)]="nit_nombre" />
                        </div>
                        <div *ngFor="let resultC of datac2">
                            <div class="card card-body mb-1" (click)="touchNit(resultC)" style="cursor: pointer;"
                                *ngIf="bandera2">
                                <h6>Detalle: {{ resultC.razsoc }}.</h6>
                                <small class="text-primary">NIT: {{ resultC.nit }}.</small>
                            </div>
                        </div>
                    </div>

                    <div>
                        <input class="form-control" type="text" name="nit" [(ngModel)]="teso13.nit" readonly
                            maxlength="16" required />
                        <small *ngIf="!registerForm.controls['nit']?.valid && registerForm.controls['nit']?.touched"
                            class="invalid-feedback d-block">Este Campo es requerido</small>
                    </div>
                </div>

            </div>

            <hr />

            <!-- SUBDIRECCIÓN / DEPENDENCIA -->
            <div class="row">
                <!-- Subdirección (codcen) -->
                <div class="col">
                    <label><b>Subdirección</b></label>
                    <input type="text" class="form-control" name="subdir_name" placeholder="Buscar Subdirección"
                        (input)="buscarSubdir($event)" [(ngModel)]="subdir_nombre" />
                    <div *ngFor="let r of dataSubdir">
                        <div class="card card-body mb-1" (click)="touchSubdir(r)" style="cursor: pointer;"
                            *ngIf="banderaSubdir">
                            <h6>Detalle: {{ r.detalle }}.</h6>
                            <small class="text-primary">Código: {{ r.codcen }}</small>
                        </div>
                    </div>

                    <input class="form-control mt-1" type="text" name="codcen" [(ngModel)]="teso13.codcen" readonly
                        maxlength="6" required />
                    <small *ngIf="!registerForm.controls['codcen']?.valid && registerForm.controls['codcen']?.touched"
                        class="invalid-feedback d-block">Este Campo es requerido</small>
                </div>

                <!-- Dependencia (coddep) -->
                <div class="col">
                    <label><b>Dependencia</b></label>
                    <input type="text" class="form-control" name="coddep_nombre" [(ngModel)]="coddep_nombre"
                        placeholder="Buscar Dependencia" (input)="buscarDep($event)" />
                    <div *ngFor="let r2 of datac28">
                        <div class="card card-body mb-1" (click)="touchDep(r2)" style="cursor: pointer;"
                            *ngIf="bandera28">
                            <h6>Detalle: {{ r2.detalle }}.</h6>
                            <small class="text-primary">Código: {{ r2.coddep }}</small>
                        </div>
                    </div>

                    <input class="form-control mt-1" type="text" name="coddep" [(ngModel)]="teso13.coddep" maxlength="6"
                        readonly required />
                    <small *ngIf="!registerForm.controls['coddep']?.valid && registerForm.controls['coddep']?.touched"
                        class="invalid-feedback d-block">Este Campo es requerido</small>
                </div>
            </div>

            <!-- CENTRO DE COSTO (VARIOS) independiente -->
            <div class="row mt-3">
                <div class="col">
                    <label><b>Centro de Costo (varios)</b></label>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" (change)="toggleCCVarios()" id="chkCCVarios"
                            [checked]="ccVarios" />
                        <label class="form-check-label" for="chkCCVarios">Habilitar múltiples Centros de Costo</label>
                    </div>

                    <input type="text" class="form-control" name="cc_name" placeholder="Buscar Centro de Costo"
                        (input)="buscarCC($event)" [(ngModel)]="cc_nombre" [disabled]="!ccVarios" />

                    <div *ngFor="let rc of dataCC">
                        <div class="card card-body mb-1" (click)="touchCCVarios(rc)" style="cursor: pointer;"
                            *ngIf="banderaCC">
                            <h6>Detalle: {{ rc.detalle }}.</h6>
                            <small class="text-primary">Código: {{ rc.codcen }}</small>
                        </div>
                    </div>

                    <input class="form-control mt-1" type="text" placeholder="Código seleccionado"
                        [(ngModel)]="cc_actual_cod" name="cc_cod_visual" readonly maxlength="6" />

                    <div class="mt-2">
                        <button type="button" class="btn btn-outline-primary btn-sm" (click)="addCentro()"
                            [disabled]="!ccVarios">
                            + Agregar centro de costo
                        </button>
                    </div>

                    <div class="mt-3" *ngIf="centros?.length > 0">
                        <h6>Centros de Costo agregados ({{ centros.length }})</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 110px;">Cod. Centro</th>
                                        <th>Detalle Centro</th>
                                        <th style="width: 70px;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let c of centros; let i = index">
                                        <td>{{ c.codcen }}</td>
                                        <td>{{ c.detalleCC || '(sin detalle)' }}</td>
                                        <td>
                                            <button type="button" class="btn btn-sm btn-danger"
                                                (click)="removeCentro(i)">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <small class="text-muted">Estos centros son independientes de Subdirección/Dependencia.</small>
                    </div>

                    <!-- Campo oculto JSON para backend -->
                    <input type="hidden" name="centros_costos" [ngModel]="teso13.centros_costos" />
                </div>
            </div>

            <hr />

            <!-- Factura / Periodo / Folios / Anexos -->
            <div class="row">
                <div class="col">
                    <label><b>Numero de Factura</b></label>
                    <input type="text" class="form-control" name="numfac" [(ngModel)]="teso13.numfac" maxlength="50"
                        required />
                    <small *ngIf="!registerForm.controls['numfac']?.valid && registerForm.controls['numfac']?.touched"
                        class="invalid-feedback d-block">Este Campo es requerido</small>
                </div>

                <div class="col">
                    <label><b>Periodo de Facturación</b></label>
                    <select class="form-select" name="perfac" [(ngModel)]="teso13.perfac" required>
                        <option *ngFor="let per of periodos" [value]="per">{{ per }}</option>
                    </select>
                    <small *ngIf="!registerForm.controls['perfac']?.valid && registerForm.controls['perfac']?.touched"
                        class="invalid-feedback d-block">Este Campo es requerido</small>
                </div>

                <div class="col">
                    <label><b>Número de Folios</b></label>
                    <input type="number" class="form-control" name="numfol" [(ngModel)]="teso13.numfol" required />
                    <small *ngIf="!registerForm.controls['numfol']?.valid && registerForm.controls['numfol']?.touched"
                        class="invalid-feedback d-block">Este Campo es requerido</small>
                </div>

                <div class="col">
                    <label><b>Numero de anexos magneticos</b></label>
                    <input type="number" class="form-control" name="anexos_magneticos"
                        [(ngModel)]="teso13.anexos_magneticos" maxlength="15" required />
                    <small
                        *ngIf="!registerForm.controls['anexos_magneticos']?.valid && registerForm.controls['anexos_magneticos']?.touched"
                        class="invalid-feedback d-block">Este Campo es requerido</small>
                </div>
            </div>

            <div class="row mt-2">
                <div class="col">
                    <label><b>Fecha de Facturación</b></label>
                    <input type="date" class="form-control" name="fecfac" min="2018-01-01" max="2030-12-31"
                        [(ngModel)]="teso13.fecfac" required />
                    <small *ngIf="!registerForm.controls['fecfac']?.valid && registerForm.controls['fecfac']?.touched"
                        class="invalid-feedback d-block">Este Campo es requerido</small>
                </div>

                <div class="col">
                    <label><b>Valor</b></label>
                    <input type="text" class="form-control" name="valor" [(ngModel)]="teso13.valor" maxlength="20"
                        required (input)="onInputChange($event)" />
                    <small *ngIf="!registerForm.controls['valor']?.valid && registerForm.controls['valor']?.touched"
                        class="invalid-feedback d-block">Este Campo es requerido</small>
                </div>

                <div class="col">
                    <label><b>Numero de Contrato</b></label>
                    <input type="text" class="form-control" name="numcon" [(ngModel)]="teso13.numcon" maxlength="19" />
                    <small class="text-muted">Opcional</small>
                </div>
            </div>

            <!-- Detalle -->
            <div class="row mt-3">
                <div class="input-group">
                    <span class="input-group-text"><b>Detalle</b></span>
                    <textarea class="form-control" name="detalle" [(ngModel)]="teso13.detalle" maxlength="2000"
                        required></textarea>
                </div>
                <small *ngIf="!registerForm.controls['detalle']?.valid && registerForm.controls['detalle']?.touched"
                    class="invalid-feedback d-block">Este Campo es requerido</small>
            </div>

        </div>

        <br />
        <button type="submit" class="btn btn-success" [disabled]="registerForm.invalid">Actualizar</button>
    </form>
</div>